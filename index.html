<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>HackHub Gallery</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Roboto:wght@400;700&display=swap');

        :root {
            --primary-color: #ff6600; /* Исходный оранжевый */
            --secondary-color: #121212;
            --light-text-color: #eee;
            --dark-text-color: #121212;
            --card-bg: #1e1e1e;
            --header-bg: linear-gradient(90deg, #000000, #1a1a1a, #000000);
            --tooltip-bg: #333;
            --tooltip-text: var(--light-text-color);
        }

        body {
            margin: 0;
            background-color: var(--secondary-color);
            color: var(--light-text-color);
            font-family: 'Roboto', Arial, sans-serif;
            overflow-x: hidden;
            line-height: 1.6;
            perspective: 1px; /* Для параллакса */
            transform-style: preserve-3d; /* Для параллакса */
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
            color: var(--primary-color);
        }

        /* Disclaimer and background effects */
        #disclaimer {
            position: fixed;
            z-index: 10000;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 1s ease;
        }
        #disclaimer img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 20px;
            box-shadow: 0 0 40px var(--primary-color);
        }
        #disclaimer.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .smoke-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.2;
            z-index: -2; /* Изменено на -2 для параллакса */
            transform: translateZ(-1px) scale(2); /* Для параллакса */
        }

        .spotlight {
            position: fixed;
            top: -20%;
            width: 60vw;
            height: 160vh;
            background: radial-gradient(ellipse at center, rgba(255,255,255,0.08) 0%, transparent 70%);
            pointer-events: none;
            mix-blend-mode: screen;
            z-index: -1; /* Изменено на -1 для параллакса */
            transform-origin: center;
            animation: spin 25s linear infinite;
            transform: translateZ(-0.5px) scale(1.5); /* Для параллакса */
        }
        .spotlight.left {
            left: -20vw;
        }
        .spotlight.right {
            right: -20vw;
            animation-direction: reverse;
        }

        @keyframes spin {
            0% { transform: rotate(0deg) translateX(0) translateZ(-0.5px) scale(1.5); }
            100% { transform: rotate(360deg) translateX(0) translateZ(-0.5px) scale(1.5); }
        }

        #cursor-light {
            position: fixed;
            top: 0;
            left: 0;
            width: 180px;
            height: 180px;
            pointer-events: none;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,102,0,0.5) 0%, rgba(255,102,0,0) 60%);
            filter: blur(40px);
            transform: translate(-50%, -50%);
            z-index: 9999;
            will-change: transform;
        }

        /* Header */
        header {
            background: var(--header-bg);
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 0 25px rgba(255, 102, 0, 0.7);
            position: sticky;
            top: 0;
            z-index: 100;
            flex-wrap: wrap;
            gap: 15px;
        }
        .logo {
            font-family: 'Montserrat', sans-serif;
            font-size: 44px;
            font-weight: 900;
            color: #fff;
            cursor: default;
            text-shadow: 0 0 10px var(--primary-color);
        }
        .logo span {
            background-color: var(--primary-color);
            padding: 0 12px;
            color: var(--dark-text-color);
            border-radius: 8px;
            box-shadow: 0 0 12px var(--primary-color);
        }
        .search input {
            padding: 12px 20px;
            width: 350px;
            border-radius: 30px;
            border: 2px solid var(--primary-color);
            background-color: #222;
            color: var(--light-text-color);
            font-size: 18px;
            transition: all 0.3s ease;
        }
        .search input:focus {
            box-shadow: 0 0 15px var(--primary-color);
            border-color: #ff8800;
            outline: none;
        }
        .logout-btn {
            background: none;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 10px 22px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s ease;
            font-size: 16px;
        }
        .logout-btn:hover {
            background-color: var(--primary-color);
            color: var(--dark-text-color);
            box-shadow: 0 0 15px var(--primary-color);
        }

        /* Online Users Counter */
        .online-users-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #2a2a2a;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 16px;
            color: var(--light-text-color);
            border: 1px solid #444;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            white-space: nowrap;
        }

        .online-users-icon {
            color: var(--primary-color);
            font-size: 20px;
            animation: pulse-online 2s infinite;
        }

        @keyframes pulse-online {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Categories Navigation */
        .categories {
            background-color: #1a1a1a;
            padding: 15px 30px;
            box-shadow: inset 0 -2px 0 #333;
        }
        .categories ul {
            list-style: none;
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            gap: 20px;
            margin: 0;
            padding: 0;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) #333;
        }
        .categories ul::-webkit-scrollbar {
            height: 8px;
        }
        .categories ul::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 10px;
        }
        .categories ul::-webkit-scrollbar-track {
            background-color: #333;
        }
        .categories li a {
            color: var(--primary-color);
            font-weight: bold;
            text-decoration: none;
            font-size: 16px;
            padding: 8px 15px;
            border-radius: 25px;
            transition: background 0.2s, color 0.2s, transform 0.2s;
            white-space: nowrap;
        }
        .categories li a:hover,
        .categories li a.active {
            background-color: var(--primary-color);
            color: var(--dark-text-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 102, 0, 0.4);
        }

        .categories li a.premium {
            color: gold;
            font-weight: 900;
            animation: blink 1.4s infinite;
            text-shadow: 0 0 8px gold;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* Gallery Loading Indicator */
        .loading-indicator {
            text-align: center;
            padding: 50px 0;
            font-size: 1.5em;
            color: #ccc;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin-loader 1s linear infinite;
        }
        @keyframes spin-loader {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Gallery */
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 22px;
            padding: 30px 35px;
            max-width: 1300px;
            margin: 0 auto;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(255, 102, 0, 0.3);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            position: relative; /* Для кнопок */
        }
        .card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 5px 25px var(--primary-color), 0 0 40px #ff9900;
        }
        .card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
            border-bottom: 1px solid #333;
        }
        .card h3 {
            font-size: 18px;
            font-weight: 700;
            margin: 15px 18px 8px;
            color: var(--primary-color);
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
        }
        .card .actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 18px 15px;
            margin-top: auto;
        }
        .card .btn {
            background-color: transparent;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 15px;
            padding: 5px 0;
            transition: color 0.2s, text-decoration 0.2s;
            position: relative; /* Для тултипов */
        }
        .card .btn:hover {
            color: #ff9900;
            text-decoration: underline;
        }

        /* Tooltip styles */
        .tooltip {
            position: absolute;
            background-color: var(--tooltip-bg);
            color: var(--tooltip-text);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.85em;
            white-space: nowrap;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, transform 0.2s ease;
            transform: translateY(-5px);
            bottom: 100%; /* По умолчанию над кнопкой */
            left: 50%;
            transform: translateX(-50%) translateY(-5px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .btn:hover .tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-10px);
        }

        .like-section {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .like-btn {
            font-size: 20px;
            color: #ccc;
            transition: color 0.2s;
        }
        .like-btn.liked {
            color: red;
            filter: drop-shadow(0 0 5px red);
        }
        .like-count {
            font-size: 15px;
            color: var(--light-text-color);
        }
        .woman-emoji {
            font-size: 1.3em;
            margin-left: 8px;
            vertical-align: middle;
            filter: drop-shadow(0 0 5px #ff6600);
        }
        .share-btn {
            font-size: 18px; /* Немного больше иконка */
        }

        /* Top Creators Section */
        .top-creators-section {
            padding: 50px 30px;
            background-color: #1a1a1a;
            margin-top: 50px;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.5);
            text-align: center;
        }
        .creator-card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 25px;
            max-width: 1200px;
            margin: 30px auto 0;
        }
        .creator-card {
            background-color: #2a2a2a;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(255, 102, 0, 0.2);
            width: calc(25% - 25px); /* Четыре карточки в ряд */
            min-width: 200px;
            box-sizing: border-box;
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .creator-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(255, 102, 0, 0.5);
            background-color: #333;
        }
        .creator-card img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-color);
            margin-bottom: 15px;
            box-shadow: 0 0 10px var(--primary-color);
        }
        .creator-card h3 {
            font-size: 1.4em;
            margin: 0 0 5px;
            color: #fff;
        }
        .creator-card p {
            font-size: 0.9em;
            color: #aaa;
            margin: 0;
            text-align: center;
        }
        .creator-card .view-profile-btn {
            background-color: var(--primary-color);
            color: var(--dark-text-color);
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        .creator-card .view-profile-btn:hover {
            background-color: #e65c00;
            transform: scale(1.05);
        }


        /* Reviews Section */
        .reviews-section {
            padding: 50px 30px;
            background-color: #1a1a1a;
            margin-top: 50px;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.5);
            text-align: center;
        }
        .review-card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 25px;
            max-width: 1200px;
            margin: 30px auto 0;
        }
        .review-card {
            background-color: #222;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 0 15px rgba(255, 102, 0, 0.2);
            width: calc(33% - 25px);
            min-width: 280px;
            box-sizing: border-box;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .review-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(255, 102, 0, 0.5);
        }
        .review-card p {
            font-size: 1.05em;
            color: #ccc;
            margin-bottom: 15px;
            font-style: italic;
        }
        .review-card .author {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1em;
        }
        .review-card .rating {
            color: gold;
            font-size: 1.2em;
            margin-top: 10px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(18, 18, 18, 0.98);
            opacity: 0;
            pointer-events: none;
            overflow: hidden;
            transition: opacity 0.3s ease-out;
            /* Flexbox для центрирования содержимого модального окна */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal.open {
            display: flex; /* Важно: использовать flex при открытии */
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content-wrapper {
            position: relative; /* Для позиционирования close button абсолютно внутри */
            border-radius: 18px;
            box-shadow: 0 0 40px var(--primary-color);
            overflow: hidden; /* Обрезает углы изображения, чтобы соответствовать border-radius */
            max-width: 90%; /* Ограничение размера контейнера модального изображения */
            max-height: 90%;
        }

        .modal-content {
            display: block; /* Убедимся, что изображение является блочным элементом */
            max-width: 100%; /* Изображение не будет выходить за пределы контейнера */
            max-height: 100%;
            object-fit: contain; /* Сохраняет пропорции изображения */
            transform: none !important; /* Отменяем любые предыдущие трансформации для центрирования */
            top: auto !important;
            left: auto !important;
            width: auto !important;
            height: auto !important;
            position: relative !important; /* Отменяем absolute позиционирование из JS */
            opacity: 1 !important; /* Всегда видимое, если модальное окно открыто */
            transition: none !important; /* Отменяем анимации из JS */
        }

        .close {
            position: absolute;
            top: 25px;
            right: 45px;
            color: var(--primary-color);
            font-size: 48px;
            font-weight: 900;
            cursor: pointer;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.2s ease-in 0.3s, transform 0.2s ease;
            text-shadow: 0 0 10px var(--primary-color);
        }
        .close:hover {
            color: #ff9900;
            transform: scale(1.1);
        }

        .modal.open .close {
            opacity: 1;
        }

        /* Chat Styles */
        #chat-toggle-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: var(--primary-color);
            color: var(--dark-text-color);
            border: none;
            border-radius: 50%;
            width: 65px;
            height: 65px;
            font-size: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 0 25px rgba(255, 102, 0, 0.8);
            transition: transform 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
            z-index: 1000;
        }

        #chat-toggle-btn:hover {
            transform: scale(1.15) rotate(5deg);
            background-color: #e65c00;
            box-shadow: 0 0 35px rgba(255, 102, 0, 0.9);
        }

        #chat-container {
            position: fixed;
            bottom: 110px;
            right: 30px;
            width: 380px;
            height: 500px;
            background-color: #1a1a1a;
            border-radius: 15px;
            box-shadow: 0 0 35px rgba(255, 102, 0, 0.8);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: translateY(30px) scale(0.85);
            opacity: 0;
            visibility: hidden;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.3s ease, visibility 0.3s ease;
            z-index: 999;
        }

        #chat-container.open {
            transform: translateY(0) scale(1);
            opacity: 1;
            visibility: visible;
        }

        #chat-header {
            background-color: var(--primary-color);
            color: var(--dark-text-color);
            padding: 18px;
            font-weight: bold;
            font-size: 20px;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        #chat-close-btn {
            background: none;
            border: none;
            color: var(--dark-text-color);
            font-size: 28px;
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease;
        }

        #chat-close-btn:hover {
            color: #333;
            transform: rotate(90deg);
        }

        #chat-messages {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background-color: #1f1f1f;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) #2a2a2a;
        }
        #chat-messages::-webkit-scrollbar {
            width: 8px;
        }
        #chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 10px;
        }
        #chat-messages::-webkit-scrollbar-track {
            background-color: #2a2a2a;
        }

        .message {
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 85%;
            word-wrap: break-word;
            font-size: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .message.user {
            align-self: flex-end;
            background-color: var(--primary-color);
            color: var(--dark-text-color);
            border-bottom-right-radius: 8px;
        }

        .message.ai {
            align-self: flex-start;
            background-color: #333;
            color: var(--light-text-color);
            border-bottom-left-radius: 8px;
        }

        .message.loading {
            align-self: flex-start;
            background-color: #333;
            color: #eee;
            border-bottom-left-radius: 8px;
            font-style: italic;
            opacity: 0.8;
            animation: pulse 1.5s infinite ease-in-out;
        }
        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 0.5; }
            100% { opacity: 0.8; }
        }

        #chat-input-container {
            display: flex;
            padding: 15px;
            border-top: 1px solid #333;
            background-color: #1a1a1a;
        }

        #chat-input {
            flex-grow: 1;
            padding: 12px 18px;
            border-radius: 25px;
            border: 2px solid var(--primary-color);
            background-color: #2a2a2a;
            color: var(--light-text-color);
            font-size: 16px;
            outline: none;
            margin-right: 12px;
            transition: all 0.3s ease;
        }
        #chat-input:focus {
            box-shadow: 0 0 10px var(--primary-color);
            border-color: #ff8800;
        }

        #chat-send-btn {
            background-color: var(--primary-color);
            color: var(--dark-text-color);
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }

        #chat-send-btn:hover {
            background-color: #e65c00;
            transform: scale(1.05);
        }

        /* New Sections Styles */
        .section-title {
            text-align: center;
            font-size: 3em;
            margin: 40px 0 20px;
            color: #fff;
            text-shadow: 0 0 15px var(--primary-color);
        }
        .section-description {
            text-align: center;
            font-size: 1.1em;
            color: #aaa;
            max-width: 800px;
            margin: 0 auto 40px;
        }

        /* Popular Section (example, could reuse .gallery) */
        .popular-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 22px;
            padding: 30px 35px;
            max-width: 1300px;
            margin: 0 auto;
        }

        /* Reviews Section */
        .reviews-section {
            padding: 50px 30px;
            background-color: #1a1a1a;
            margin-top: 50px;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.5);
            text-align: center;
        }
        .review-card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 25px;
            max-width: 1200px;
            margin: 30px auto 0;
        }
        .review-card {
            background-color: #222;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 0 15px rgba(255, 102, 0, 0.2);
            width: calc(33% - 25px);
            min-width: 280px;
            box-sizing: border-box;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .review-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(255, 102, 0, 0.5);
        }
        .review-card p {
            font-size: 1.05em;
            color: #ccc;
            margin-bottom: 15px;
            font-style: italic;
        }
        .review-card .author {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1em;
        }
        .review-card .rating {
            color: gold;
            font-size: 1.2em;
            margin-top: 10px;
        }

        /* Scroll to Top Button */
        #scroll-to-top-btn {
            display: none; /* Скрыть по умолчанию */
            position: fixed;
            bottom: 110px; /* Над кнопкой чата */
            right: 30px;
            background-color: rgba(var(--primary-color-rgb, 255, 102, 0), 0.8); /* Используем RGB для прозрачности */
            color: var(--dark-text-color);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 102, 0, 0.6);
            transition: background-color 0.3s ease, transform 0.3s ease, opacity 0.3s ease;
            z-index: 998; /* Чуть ниже кнопки чата */
        }
        #scroll-to-top-btn:hover {
            background-color: var(--primary-color);
            transform: scale(1.1);
            box-shadow: 0 0 25px rgba(255, 102, 0, 0.8);
        }

        /* Footer */
        footer {
            background: var(--header-bg);
            color: var(--light-text-color);
            padding: 40px 30px;
            text-align: center;
            box-shadow: 0 0 25px rgba(255, 102, 0, 0.7);
            margin-top: 50px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: flex-start;
            gap: 30px;
        }
        .footer-column {
            flex: 1;
            min-width: 200px;
            text-align: left;
        }
        .footer-column h4 {
            color: var(--primary-color);
            font-size: 1.4em;
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        .footer-column ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-column ul li {
            margin-bottom: 10px;
        }
        .footer-column ul li a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        .footer-column ul li a:hover {
            color: var(--primary-color);
        }
        .social-icons {
            margin-top: 20px;
        }
        .social-icons a {
            color: var(--primary-color);
            font-size: 2em;
            margin: 0 15px;
            transition: transform 0.2s ease, color 0.2s ease;
        }
        .social-icons a:hover {
            color: #ff9900;
            transform: scale(1.2);
        }
        .footer-bottom-text {
            width: 100%;
            margin-top: 40px;
            font-size: 0.9em;
            color: #aaa;
            border-top: 1px solid #333;
            padding-top: 20px;
        }
        .color-switcher {
            margin-top: 20px;
        }
        .color-switcher button {
            background-color: #555;
            border: 2px solid #777;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            margin: 0 5px;
            transition: transform 0.2s;
        }
        .color-switcher button:hover {
            transform: scale(1.1);
        }
        .color-switcher button.active {
            border-color: #fff;
            box-shadow: 0 0 10px #fff;
        }
        .color-switcher button[data-color="#ff6600"] { background-color: #ff6600; }
        .color-switcher button[data-color="#00ccff"] { background-color: #00ccff; }
        .color-switcher button[data-color="#cc33ff"] { background-color: #cc33ff; }
        .color-switcher button[data-color="#33ff66"] { background-color: #33ff66; }


        /* Адаптивность */
        @media (max-width: 1200px) {
            .creator-card {
                width: calc(33% - 25px); /* Три карточки в ряд */
            }
        }
        @media (max-width: 1024px) {
            .gallery, .popular-gallery {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
                padding: 20px 25px;
            }
            .search input {
                width: 250px;
            }
            .review-card {
                width: calc(50% - 25px);
            }
            .footer-column {
                flex-basis: 45%;
            }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                align-items: flex-start;
                padding: 15px 20px;
            }
            .logo {
                font-size: 36px;
                margin-bottom: 15px;
            }
            .search input {
                width: 100%;
                margin-bottom: 15px;
            }
            .logout-btn {
                width: 100%;
                text-align: center;
            }
            .online-users-container {
                order: -1;
                width: 100%;
                justify-content: center;
                margin-bottom: 15px;
                padding: 10px 15px;
            }
            .categories {
                padding: 10px 20px;
            }
            .categories li a {
                font-size: 14px;
                padding: 6px 10px;
            }
            .gallery, .popular-gallery {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                padding: 15px 20px;
            }
            .card h3 {
                font-size: 16px;
            }
            .card img {
                height: 180px;
            }
            #chat-container {
                width: 90vw;
                height: 70vh;
                right: 5vw;
                bottom: 90px;
            }
            #chat-toggle-btn {
                bottom: 20px;
                right: 20px;
                width: 55px;
                height: 55px;
                font-size: 24px;
            }
            #scroll-to-top-btn {
                bottom: 85px; /* Корректировка для мобильных */
                right: 20px;
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
            .close {
                top: 15px;
                right: 25px;
                font-size: 36px;
            }
            .section-title {
                font-size: 2.2em;
            }
            .section-description {
                font-size: 1em;
                margin-bottom: 30px;
            }
            .review-card, .creator-card {
                width: 90%;
                margin: 0 auto;
            }
            .creator-card-container {
                flex-direction: column;
                align-items: center;
            }
            footer {
                flex-direction: column;
                align-items: center;
                padding: 30px 20px;
            }
            .footer-column {
                width: 100%;
                text-align: center;
                margin-bottom: 20px;
            }
            .footer-column h4 {
                border-bottom: none;
                padding-bottom: 0;
                margin-bottom: 10px;
            }
            .social-icons a {
                font-size: 1.8em;
                margin: 0 10px;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 30px;
            }
            .search input {
                font-size: 15px;
                padding: 10px 15px;
            }
            .logout-btn {
                font-size: 14px;
                padding: 8px 15px;
            }
            .categories li a {
                font-size: 13px;
                padding: 5px 8px;
            }
            .gallery, .popular-gallery {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 15px;
            }
            .card img {
                height: 150px;
            }
            .card h3 {
                font-size: 14px;
            }
            .card .btn, .like-count {
                font-size: 13px;
            }
            .like-btn {
                font-size: 18px;
            }
            .woman-emoji {
                font-size: 1.1em;
            }
            #chat-container {
                width: 95vw;
                right: 2.5vw;
                bottom: 80px;
                height: 60vh;
            }
            #chat-toggle-btn {
                width: 50px;
                height: 50px;
                font-size: 22px;
            }
            #chat-header {
                font-size: 16px;
                padding: 12px;
            }
            #chat-close-btn {
                font-size: 22px;
            }
            .message {
                font-size: 13px;
                padding: 10px 15px;
            }
            #chat-input {
                font-size: 14px;
                padding: 8px 12px;
            }
            #chat-send-btn {
                font-size: 14px;
                padding: 8px 15px;
            }
            .section-title {
                font-size: 1.8em;
            }
            .review-card {
                padding: 20px;
            }
            .review-card p {
                font-size: 0.95em;
            }
        }
    </style>
</head>
<body>

    <div id="disclaimer">
        <img src="https://raw.githubusercontent.com/antareti/hackhub/main/22.gif" alt="Disclaimer">
    </div>

    <video class="smoke-video" autoplay loop muted>
        <source src="https://raw.githubusercontent.com/antareti/hackhub/main/smoke-loop.mp4" type="video/mp4">
    </video>

    <div class="spotlight left"></div>
    <div class="spotlight right"></div>

    <div id="cursor-light"></div>

    <header>
        <div class="logo">Hack<span>Hub</span></div>
        <div class="search">
            <input id="searchInput" type="text" placeholder="Поиск...">
        </div>
        <div class="online-users-container">
            <i class="fas fa-users online-users-icon"></i>
            <span id="online-users-count">500</span> онлайн
        </div>
        <button class="logout-btn" onclick="logout()">Выйти</button>
    </header>

    <nav class="categories">
        <ul id="categories-list">
            <li><a href="#" class="active" data-category="main">Главная</a></li>
            <li><a href="#" data-category="categories">Категории</a></li>
            <li><a href="#" data-category="new">Новое</a></li>
            <li><a href="#" data-category="popular">Популярное</a></li>
            <li><a href="#" data-category="best">Лучшее</a></li>
            <li><a href="#" data-category="gif">GIF</a></li>
            <li><a href="#" data-category="vr">VR</a></li>
            <li><a href="#" data-category="model-day">Модель дня</a></li>
            <li><a href="video.html" data-category="video">🎥 Видео</a></li>
            <li><a href="#" data-category="community">Сообщество</a></li>
            <li><a href="#" data-category="support">Поддержка</a></li>
            <li><a href="premium.html" class="premium" data-category="premium">💎 Премиум</a></li>
        </ul>
    </nav>

    <h2 class="section-title">✨ Галерея</h2>
    <p class="section-description">Погрузитесь в нашу постоянно пополняющуюся коллекцию захватывающих изображений!</p>
    <div class="loading-indicator" id="gallery-loading">
        <div class="loading-spinner"></div>
        Загрузка изображений...
    </div>
    <section class="gallery" id="gallery"></section>

    ---

    <h2 class="section-title">🔥 Популярное</h2>
    <p class="section-description">Оцените самые просматриваемые и понравившиеся изображения за последнюю неделю.</p>
    <div class="loading-indicator" id="popular-gallery-loading" style="display: none;">
        <div class="loading-spinner"></div>
        Загрузка популярных изображений...
    </div>
    <section class="gallery popular-gallery" id="popular-gallery"></section>

    ---

    <section class="top-creators-section">
        <h2 class="section-title">🏆 Топ Авторы</h2>
        <p class="section-description">Познакомьтесь с талантливыми создателями, чьи работы вдохновляют наше сообщество.</p>
        <div class="creator-card-container" id="creator-cards">
            <div class="creator-card">
                <img src="https://raw.githubusercontent.com/antareti/hackhub/main/avatars/avatar1.jpg" alt="Creator Avatar">
                <h3>Имя Автора 1</h3>
                <p>Художник, специализирующийся на футуристических пейзажах.</p>
                <button class="view-profile-btn">Профиль</button>
            </div>
            <div class="creator-card">
                <img src="https://raw.githubusercontent.com/antareti/hackhub/main/avatars/avatar2.jpg" alt="Creator Avatar">
                <h3>Имя Автора 2</h3>
                <p>Фотограф, создающий портреты с уникальной атмосферой.</p>
                <button class="view-profile-btn">Профиль</button>
            </div>
            <div class="creator-card">
                <img src="https://raw.githubusercontent.com/antareti/hackhub/main/avatars/avatar3.jpg" alt="Creator Avatar">
                <h3>Имя Автора 3</h3>
                <p>Дизайнер 3D-моделей, известные работы в стиле киберпанк.</p>
                <button class="view-profile-btn">Профиль</button>
            </div>
            <div class="creator-card">
                <img src="https://raw.githubusercontent.com/antareti/hackhub/main/avatars/avatar4.jpg" alt="Creator Avatar">
                <h3>Имя Автора 4</h3>
                <p>Цифровой художник, мастер абстрактных композиций.</p>
                <button class="view-profile-btn">Профиль</button>
            </div>
        </div>
    </section>

    ---

    <section class="reviews-section">
        <h2 class="section-title">💖 Отзывы наших пользователей</h2>
        <p class="section-description">Узнайте, что говорят люди о HackHub Gallery!</p>
        <div class="review-card-container">
            <div class="review-card">
                <p>"HackHub Gallery - это просто нечто! Здесь всегда можно найти вдохновение, а качество изображений просто зашкаливает. Отличная работа!"</p>
                <div class="author">- Мария С.</div>
                <div class="rating">
                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                </div>
            </div>
            <div class="review-card">
                <p>"Я каждый день захожу сюда. Интерфейс очень удобный, а функция поиска работает идеально. Мои наилучшие рекомендации!"</p>
                <div class="author">- Алексей К.</div>
                <div class="rating">
                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                </div>
            </div>
            <div class="review-card">
                <p>"Потрясающая коллекция! Изображения уникальны, а атмосфера сайта очень крутая с этими эффектами. Однозначно 5 звезд!"</p>
                <div class="author">- Елена В.</div>
                <div class="rating">
                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                </div>
            </div>
        </div>
    </section>


    <div id="imageModal" class="modal">
        <div class="modal-content-wrapper">
            <span class="close" onclick="closeModal()">&times;</span>
            <img class="modal-content" id="modalImg" alt="Просмотр изображения">
        </div>
    </div>

    <button id="chat-toggle-btn"><i class="fas fa-comment-dots"></i></button>
    <button id="scroll-to-top-btn" title="Наверх"><i class="fas fa-arrow-up"></i></button>


    <div id="chat-container">
        <div id="chat-header">
            AI Ассистент
            <button id="chat-close-btn">&times;</button>
        </div>
        <div id="chat-messages">
            <div class="message ai">Привет! Я AI ассистент. Чем могу помочь?</div>
        </div>
        <div id="chat-input-container">
            <input type="text" id="chat-input" placeholder="Введите ваше сообщение...">
            <button id="chat-send-btn"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <footer>
        <div class="footer-column">
            <h4>О нас</h4>
            <ul>
                <li><a href="#">Наша миссия</a></li>
                <li><a href="#">Команда</a></li>
                <li><a href="#">Карьера</a></li>
            </ul>
        </div>
        <div class="footer-column">
            <h4>Помощь</h4>
            <ul>
                <li><a href="#">FAQ</a></li>
                <li><a href="#">Связаться с нами</a></li>
                <li><a href="#">Политика конфиденциальности</a></li>
                <li><a href="#">Условия использования</a></li>
            </ul>
        </div>
        <div class="footer-column">
            <h4>Социальные сети</h4>
            <div class="social-icons">
                <a href="#" target="_blank" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="#" target="_blank" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                <a href="#" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" target="_blank" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
            </div>
        </div>
        <div class="footer-column">
            <h4>Настроить тему</h4>
            <div class="color-switcher">
                <button data-color="#ff6600" class="active" title="Оранжевый"></button>
                <button data-color="#00ccff" title="Голубой"></button>
                <button data-color="#cc33ff" title="Фиолетовый"></button>
                <button data-color="#33ff66" title="Зеленый"></button>
            </div>
            <p style="font-size: 0.8em; color: #888; margin-top: 10px;">(Только для демонстрации)</p>
        </div>
        <div class="footer-bottom-text">
            &copy; 2025 HackHub. Все права защищены. <br> Создано с ❤️ для сообщества.
        </div>
    </footer>

    <script>
        // DOM Elements
        const disclaimer = document.getElementById("disclaimer");
        const gallery = document.getElementById("gallery");
        const popularGallery = document.getElementById("popular-gallery");
        const searchInput = document.getElementById("searchInput");
        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImg");
        const chatToggleBtn = document.getElementById('chat-toggle-btn');
        const chatContainer = document.getElementById('chat-container');
        const chatCloseBtn = document.getElementById('chat-close-btn');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSendBtn = document.getElementById('chat-send-btn');
        const onlineUsersCountElement = document.getElementById('online-users-count');
        const categoriesList = document.getElementById('categories-list');
        const scrollToTopBtn = document.getElementById('scroll-to-top-btn');
        const galleryLoading = document.getElementById('gallery-loading');
        const popularGalleryLoading = document.getElementById('popular-gallery-loading');

        // Global variables
        let activeThumbnail; // Эта переменная теперь не используется для анимации, но оставлена для потенциального использования
        let cards = []; // For main gallery
        let popularCards = []; // For popular gallery
        let isSendingMessage = false;

        // API Key for OpenRouter (replace with your actual key in a real project, preferably server-side)
        const OPENROUTER_API_KEY = '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';
        const OPENROUTER_API_URL = 'https://openrouter.ai/api/v1/chat/completions';

        // Chat history for AI assistant context
        let chatHistory = [{ role: 'system', content: 'You are a helpful and friendly AI assistant for HackHub Gallery. Provide concise, encouraging, and enthusiastic answers. You can also give recommendations for categories or features. Your responses should be in Russian. Try to sound energetic and positive!' }];

        const femaleNames = [
            "Анна", "Елена", "Мария", "Ольга", "Наталья", "Светлана", "Татьяна", "Ирина", "Екатерина", "Дарья",
            "Анастасия", "София", "Виктория", "Полина", "Ксения", "Александра", "Елизавета", "Валерия", "Варвара", "Вероника",
            "Юлия", "Алина", "Арина", "Маргарита", "Аделина", "Кира", "Эвелина", "Злата", "Милана", "Диана"
        ];
        const repoOwner = "antareti";
        const repoName = "hackhub";
        const folderPath = "images";

        // --- Utility Functions ---

        function getRandomFemaleName() {
            const randomIndex = Math.floor(Math.random() * femaleNames.length);
            return femaleNames[randomIndex];
        }

        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        // Function to convert hex to RGB for CSS variables
        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `${r}, ${g}, ${b}`;
        }

        // --- Gallery and Image Handling ---

        function createCard(file, isPopular = false) {
            const card = document.createElement("div");
            card.className = "card";
            const displayedTitle = getRandomFemaleName();
            card.setAttribute('data-title', displayedTitle.toLowerCase());
            const imageUrl = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/${folderPath}/${file.name}`;

            card.innerHTML = `
                <img src="${imageUrl}" alt="${file.name}" onclick="openModal('${imageUrl}')">
                <h3>${displayedTitle}</h3>
                <div class="actions">
                    <button class="btn" onclick="downloadImage('${imageUrl}')">
                        <i class="fas fa-download"></i> Скачать
                        <span class="tooltip">Скачать изображение</span>
                    </button>
                    <button class="btn share-btn" onclick="shareImage('${imageUrl}')">
                        <i class="fas fa-share-alt"></i>
                        <span class="tooltip">Поделиться</span>
                    </button>
                    <div class="like-section">
                        <button class="btn like-btn" onclick="toggleLike('${file.name}')">
                            <i class="fas fa-heart"></i>
                            <span class="tooltip">Нравится</span>
                        </button>
                        <span id="like-count-${file.name}" class="like-count">0</span>
                    </div>
                    <span class="woman-emoji">🧍‍♀️</span>
                </div>
            `;
            return card;
        }

        // Измененная функция openModal, возвращающаяся к центрированию
        function openModal(src) {
            modal.classList.add('open');
            modalImg.src = src;
            // Сброс любых инлайновых стилей трансформации, которые могли остаться от предыдущей попытки анимации
            modalImg.style.cssText = '';
        }

        // Измененная функция closeModal, возвращающаяся к простому закрытию
        function closeModal() {
            modal.classList.remove('open');
            modalImg.src = ''; // Очищаем src для экономии памяти
        }

        async function fetchImages() {
            galleryLoading.style.display = 'flex';
            // popularGalleryLoading.style.display = 'flex'; // Отображаем, если популярная галерея изначально скрыта

            try {
                const res = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`);
                const data = await res.json();

                if (!Array.isArray(data)) {
                    throw new Error("Неверный формат данных от GitHub API. Возможно, превышен лимит запросов или папка пуста.");
                }

                const imageFiles = data.filter(file => /\.(png|jpe?g|gif)$/i.test(file.name));
                const shuffledData = imageFiles.sort(() => 0.5 - Math.random());

                // Clear previous content
                gallery.innerHTML = '';
                popularGallery.innerHTML = '';
                cards = [];
                popularCards = [];

                shuffledData.forEach((file, index) => {
                    if (index < 6) { // First 6 images for "Popular"
                        const card = createCard(file, true);
                        popularGallery.appendChild(card);
                        popularCards.push(card);
                    } else {
                        const card = createCard(file);
                        gallery.appendChild(card);
                        cards.push(card);
                    }
                    updateLikeDisplay(file.name);
                });

            } catch (err) {
                console.error("Ошибка загрузки изображений:", err);
                gallery.innerHTML = `<p style="color:red;">Ошибка загрузки изображений: ${err.message}. Попробуйте позже.</p>`;
                popularGallery.innerHTML = `<p style="color:red;">Ошибка загрузки популярных изображений: ${err.message}.</p>`;
            } finally {
                galleryLoading.style.display = 'none';
                popularGalleryLoading.style.display = 'none';
            }
        }

        // --- Search and Filter ---

        function filterCards() {
            const query = searchInput.value.toLowerCase().trim();
            const allCards = [...cards, ...popularCards];

            if (!query) {
                allCards.forEach(card => card.style.display = "");
                return;
            }

            const terms = query.split(/\s+/).filter(term => term.length > 0);
            allCards.forEach(card => {
                const title = card.getAttribute("data-title");
                const match = terms.every(term => title.includes(term));
                card.style.display = match ? "" : "none";
            });
        }

        // --- Download and Share ---

        function downloadImage(url) {
            const link = document.createElement("a");
            link.href = url;
            link.download = url.split("/").pop();
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function shareImage(url) {
            if (navigator.share) {
                navigator.share({
                    title: 'HackHub Gallery Image',
                    text: 'Взгляни на это крутое изображение из HackHub Gallery!',
                    url: url,
                }).then(() => console.log('Успешно поделились!'))
                .catch((error) => console.error('Ошибка при попытке поделиться:', error));
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    alert('Ссылка на изображение скопирована в буфер обмена!');
                }).catch(err => {
                    console.error('Не удалось скопировать ссылку:', err);
                    alert('Не удалось скопировать ссылку. Попробуйте вручную.');
                });
            }
        }

        // --- Like Functionality ---

        function toggleLike(name) {
            const keyLiked = `like-${name}`;
            const keyCount = `like-count-${name}`;
            let liked = localStorage.getItem(keyLiked) === "true";
            liked = !liked;
            localStorage.setItem(keyLiked, liked);

            let count = parseInt(localStorage.getItem(keyCount) || "0");
            count = liked ? count + 1 : Math.max(0, count - 1);
            localStorage.setItem(keyCount, count);

            updateLikeDisplay(name);
        }

        function updateLikeDisplay(name) {
            const btn = document.querySelector(`.like-btn[onclick*="${name}"]`);
            const countElement = document.getElementById(`like-count-${name}`);
            const liked = localStorage.getItem(`like-${name}`) === "true";
            const count = localStorage.getItem(`like-count-${name}`) || "0";
            if (btn) btn.classList.toggle("liked", liked);
            if (countElement) countElement.textContent = count;
        }

        // --- User Authentication (Placeholder) ---

        function logout() {
            localStorage.removeItem("auth");
            window.location.href = "login.html"; // Redirect to login page
        }

        // --- Chat Functionality ---

        function appendMessage(sender, text, isLoading = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);
            messageDiv.textContent = text;
            if (isLoading) {
                messageDiv.classList.add('loading');
            }
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return messageDiv;
        }

        async function sendMessage() {
            const userMessage = chatInput.value.trim();
            if (!userMessage || isSendingMessage) return;

            appendMessage('user', userMessage);
            chatInput.value = '';
            isSendingMessage = true;

            chatHistory.push({ role: 'user', content: userMessage });

            const loadingMessage = appendMessage('ai', 'Печатает...', true);

            try {
                const requestBody = {
                    model: 'deepseek/deepseek-chat',
                    messages: chatHistory,
                    stream: false
                };
                console.log('Отправляется запрос в OpenRouter API:', JSON.stringify(requestBody, null, 2));

                const response = await fetch(OPENROUTER_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                        "HTTP-Referer": "https://antareti.github.io/hackhub/", // Important for OpenRouter
                        "X-Title": "HackHub Gallery" // Important for OpenRouter
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    let errorData;
                    try {
                        errorData = await response.json();
                        console.error('Ошибка OpenRouter API (JSON):', errorData);
                    } catch (jsonError) {
                        errorData = { message: await response.text() };
                        console.error('Ошибка OpenRouter API (текст):', errorData.message);
                    }
                    const errorMessage = errorData.message || 'Неизвестная ошибка API.';
                    throw new Error(`Ошибка OpenRouter API: ${response.status} ${response.statusText}. Детали: ${errorMessage}`);
                }

                const data = await response.json();
                console.log('Ответ от OpenRouter API:', data);

                if (data && data.choices && data.choices.length > 0 && data.choices[0].message && data.choices[0].message.content) {
                    const aiResponseContent = data.choices[0].message.content;
                    loadingMessage.textContent = aiResponseContent;
                    loadingMessage.classList.remove('loading');
                    chatHistory.push({ role: 'assistant', content: aiResponseContent });
                } else {
                    console.error('Некорректный или пустой ответ от OpenRouter API:', data);
                    throw new Error('Некорректный или пустой ответ от OpenRouter API.');
                }

            } catch (error) {
                console.error('Критическая ошибка при отправке сообщения в OpenRouter API:', error);
                loadingMessage.textContent = `Произошла ошибка: ${error.message}. Пожалуйста, попробуйте еще раз.`;
                loadingMessage.classList.remove('loading');
                // You might want to add a class for error messages to style them differently
                // loadingMessage.classList.add('error');
            } finally {
                isSendingMessage = false;
            }
        }

        // --- Online Users Counter Logic ---

        function updateOnlineUsersCount() {
            const randomCount = Math.floor(Math.random() * (1000 - 100 + 1)) + 100;
            onlineUsersCountElement.textContent = randomCount;
        }

        // --- UI Interactions and Initializations ---

        function initUI() {
            // Disclaimer
            disclaimer.classList.add("fade-out");
            setTimeout(() => disclaimer.remove(), 1000);

            // Cursor Light
            const cursorLight = document.getElementById('cursor-light');
            window.addEventListener('mousemove', e => {
                cursorLight.style.top = e.clientY + 'px';
                cursorLight.style.left = e.clientX + 'px';
            });

            // Parallax Effect
            window.addEventListener('scroll', () => {
                const scrolled = window.scrollY;
                document.querySelector('.smoke-video').style.transform = `translateZ(-1px) scale(2) translateY(${scrolled * 0.2}px)`;
                document.querySelectorAll('.spotlight').forEach(spotlight => {
                    spotlight.style.transform = `translateZ(-0.5px) scale(1.5) translateY(${scrolled * 0.1}px)`;
                });
            });

            // Search input debounce
            searchInput.addEventListener("input", debounce(filterCards, 300));

            // Modal close on Escape
            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape") closeModal();
            });

            // Chat button listeners
            chatToggleBtn.addEventListener('click', () => {
                chatContainer.classList.toggle('open');
                if (chatContainer.classList.contains('open')) {
                    chatInput.focus();
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            });
            chatCloseBtn.addEventListener('click', () => {
                chatContainer.classList.remove('open');
            });
            chatSendBtn.addEventListener('click', sendMessage);
            chatInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Scroll to Top button logic
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    scrollToTopBtn.style.display = 'flex';
                    scrollToTopBtn.style.opacity = '1';
                } else {
                    scrollToTopBtn.style.opacity = '0';
                    // Delay display: none to allow fade-out animation
                    setTimeout(() => {
                        if (window.scrollY <= 300) { // Check again in case user scrolled back quickly
                            scrollToTopBtn.style.display = 'none';
                        }
                    }, 300);
                }
            });

            scrollToTopBtn.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });

            // Category active state and auto-scroll
            categoriesList.addEventListener('click', (e) => {
                if (e.target.tagName === 'A') {
                    categoriesList.querySelectorAll('a').forEach(link => link.classList.remove('active'));
                    e.target.classList.add('active');
                    e.preventDefault(); // Prevent actual navigation for demo
                    // Optional: scroll selected category into view
                    e.target.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                }
            });

            // Primary Color Switcher
            document.querySelectorAll('.color-switcher button').forEach(button => {
                button.addEventListener('click', () => {
                    const newColor = button.getAttribute('data-color');
                    document.documentElement.style.setProperty('--primary-color', newColor);
                    document.documentElement.style.setProperty('--primary-color-rgb', hexToRgb(newColor));

                    // Update active state for buttons
                    document.querySelectorAll('.color-switcher button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                });
            });

            // Initial setting for primary-color-rgb for scroll-to-top-btn
            const initialPrimaryColor = getComputedStyle(document.documentElement).getPropertyValue('--primary-color').trim();
            document.documentElement.style.setProperty('--primary-color-rgb', hexToRgb(initialPrimaryColor));

            // Initial calls
            updateOnlineUsersCount();
            setInterval(updateOnlineUsersCount, 10000);
            fetchImages();
        }

        // Initialize everything when the DOM is ready
        document.addEventListener('DOMContentLoaded', initUI);
    </script>
</body>
</html>
